name: Common CI Pipeline

on:
  workflow_call:
    inputs:
      app_type:
        required: true
        type: string
      environment:
        required: true
        type: string

permissions:
  contents: read
  packages: write
  # security-events: write

jobs:
  build-java:
    if: inputs.app_type == 'java'
    uses: begh-azka/hello-world-repo/.github/workflows/java-build.yml@main
    with:
      environment: ${{ inputs.environment }}
    

  build-js:
    if: inputs.app_type == 'js'
    uses: begh-azka/hello-world-repo/.github/workflows/js-build.yml@main
    with:
      environment: ${{ inputs.environment }}
    

  build-python:
    if: inputs.app_type == 'python'
    uses: begh-azka/hello-world-repo/.github/workflows/python-build.yml@main
    with:
      environment: ${{ inputs.environment }}

  Validating-Env:
    if: always() && (
        needs.build-java.result == 'success' ||
        needs.build-js.result == 'success' ||
        needs.build-python.result == 'success' ||
        needs.build-dotnet.result == 'success'
      )
    runs-on: ubuntu-latest
    environment: ${{inputs.environment}}
    steps:
      - run: echo "${{ inputs.environment }} has been selected"
      
  deploy:
    name: Deploy
    needs: Validating-Env
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    steps:
      - name: Deploy
        run: |
          echo "Deploying image to ${{ inputs.environment }}"
