name: Central Js

on:
   workflow_call:
    inputs:
      build_type:
        required: true
        type: string

      dev:
        required: false
        type: string

      sit:
        required: false
        type: string

      qa:
        required: false
        type: string

      prod:
        required: false
        type: string
       
jobs:
  build:
    name: Build and Test
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: "npm"

      - name: Install Dependencies from package.json
        run: npm install

      - name: Upload node_modules
        uses: actions/upload-artifact@v4
        with:
          name: node_modules-${{ github.run_number }}
          path: node_modules

      # - name: Run Unit Testing
      #   run: npm test

      # - name: Run Code Coverage
      #   run: npm run coverage

      # - name: Start application
      #   run: npm start

  deploy:
    name: Deploy to ${{ inputs.environment }}
    runs-on: ubuntu-latest
    needs: build
    
    # THIS LINE ENABLES APPROVALS
    environment: >-
        ${{
         inputs.prod != '' && 'prod' ||
         inputs.qa   != '' && 'qa'   ||
         inputs.sit  != '' && 'sit'  ||
         inputs.dev  != '' && 'dev'
        }}

    steps:
      - name: Deployment info
        run: |
          echo "Deploying ${{ inputs.build_type }} build"
          echo "Server: ${{ inputs.prod }}"
          echo "Server: ${{ inputs.dev}}"
          echo "Server: ${{ inputs.sit }}"
          echo "Server: ${{ inputs.qa }}"
